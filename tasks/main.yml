---
# tasks file for ansible-role-oiofs

- name: 'oiofs: Install packages'
  package:
    name: "{{ item }}"
    state: installed
  with_items: "{{ openio_oiofs_packages }}"

- name: 'oiofs: Ensure OpenIO SDS configuration directory exists'
  file:
    path: "{{ openio_sds_conf_directory }}"
    owner: root
    group: root
    state: directory
    mode: 0750

- name: 'oiofs: Ensure OpenIO oiofs configuration directory exists'
  file:
    path: "{{ openio_oiofs_conf_directory }}"
    owner: root
    group: root
    state: directory
    mode: 0750

- name: 'oiofs: Install gridinit'
  include_role:
    name: ansible-role-openio-gridinit
  tags:
    - install
  when: (oiofs_mountpoints | selectattr("state", "equalto", "present") | list | count) > 0

- name: 'oiofs: Setup mountpoint'
  include_tasks: mountpoint_present.yml
  with_items: "{{ oiofs_mountpoints }}"
  loop_control:
    loop_var: mountpoint
  when: mountpoint.state == 'present'

- name: 'oiofs: Unsetup mountpoint'
  include_tasks: mountpoint_absent.yml
  with_items: "{{ oiofs_mountpoints }}"
  loop_control:
    loop_var: mountpoint
  when: mountpoint.state == 'absent'

...
